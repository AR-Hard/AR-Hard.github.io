/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

!function(i){function o(){}o.prototype=i.extend(o.prototype,{name:"Update",options:{msgPerformingUpdate:"Performing Update...",msgFinished:"Update successfull...Reload page to continue working.",msgError:"Error during update. Please visit the YOOtheme support forums."},initialize:function(e,t){this.options=i.extend({},this.options,t);var s=this;(this.form=e).find("button.update").bind("click",function(){i(this).parent().remove(),s.step()})},step:function(){var s=this.form,a=this;i.ajax({url:s.attr("action"),type:"post",datatype:"json",data:s.serialize(),beforeSend:function(){a.addMessage(a.options.msgPerformingUpdate,"loading")},success:function(t){try{t=i.parseJSON(t)}catch(e){t={error:!0,message:t}}s.find("div.message-box").find("div.message").last().removeClass("loading"),t.error?a.addMessage(t.message,"error"):(a.addMessage(t.message),t.continue?a.step():a.addMessage(a.options.msgFinished,"success"))},error:function(e,t){s.find("div.message-box").find("div.message").last().removeClass("loading"),a.addMessage(t,"error")}})},addMessage:function(e,t){e=i('<div class="message">').text(e).appendTo(this.form.find("div.message-box"));t&&e.addClass(t)}}),i.fn[o.prototype.name]=function(){var s=arguments,a=s[0]?s[0]:null;return this.each(function(){var e=i(this);if(o.prototype[a]&&e.data(o.prototype.name)&&"initialize"!=a)e.data(o.prototype.name)[a].apply(e.data(o.prototype.name),Array.prototype.slice.call(s,1));else if(!a||i.isPlainObject(a)){var t=new o;o.prototype.initialize&&t.initialize.apply(t,i.merge([e],s)),e.data(o.prototype.name,t)}else i.error("Method "+a+" does not exist on jQuery."+o.name)})}}(jQuery);