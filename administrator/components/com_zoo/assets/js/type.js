/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

!function(o){function a(){}o.extend(a.prototype,{name:"EditElements",options:{url:"index.php?option=com_zoo&controller=manager",msgNoElements:"No elements defined for this type",msgDeletelog:"Are you sure you want to delete the element?"},initialize:function(e,t){this.options=o.extend({},this.options,t);var n=this;this.list=e,this.count=0,this.noElements(),this.list.delegate("div.edit-event","click",function(){o(this).parent("li.element").toggleClass("hideconfig")}).delegate("div.delete-event","click",function(){confirm(n.options.msgDeletelog)&&o(this).parent("li.element").fadeOut(200,function(){o(this).remove(),n.noElements()})}).sortable({handle:"div.sort-event",placeholder:"element dragging",axis:"y",delay:100,tolerance:"pointer",scroll:!1,start:function(e,t){n.list.children("li.element").each(function(){o(this).data("showconfig",!o(this).hasClass("hideconfig")),o(this).addClass("hideconfig")});var i=o("div.name",t.item).height();t.helper.height(i),t.placeholder.height(i),o(this).sortable("refreshPositions")},stop:function(e,t){n.list.children("li.element").each(function(){o(this).data("showconfig")&&o(this).removeClass("hideconfig")})}}),o("#add-element ul.elements li").bind("click",function(){var t=o("<li>").addClass("element loading").prependTo(n.list);o.ajax({url:n.options.url,data:{format:"raw",task:"addelement",element:o(this).attr("class"),count:n.count++},dataType:"html",success:function(e){t.removeClass("loading").html(e),new Tips(t.find(".hasTip").get(),{maxTitleChars:50,fixed:!1}),n.noElements(),n.list.trigger("element.added",t),t.slideDown(200).effect("highlight",{},1e3)}})}),o(".core-element-configuration > ul").hide(),o(".core-element-configuration > .toggler").bind("click",function(e){e.preventDefault(),o(".core-element-configuration > ul").toggle()}),o(".core-element-configuration").delegate("div.edit-event","click",function(){o(this).parent("li.element").toggleClass("hideconfig")})},noElements:function(){this.list.find("li.no-elements").remove(),0==this.list.children("li.element").length&&o("<li>").addClass("no-elements").text(this.options.msgNoElements).appendTo(this.list)}}),o.fn[a.prototype.name]=function(){var i=arguments,n=i[0]?i[0]:null;return this.each(function(){var e=o(this);if(a.prototype[n]&&e.data(a.prototype.name)&&"initialize"!=n)e.data(a.prototype.name)[n].apply(e.data(a.prototype.name),Array.prototype.slice.call(i,1));else if(!n||o.isPlainObject(n)){var t=new a;a.prototype.initialize&&t.initialize.apply(t,o.merge([e],i)),e.data(a.prototype.name,t)}else o.error("Method "+n+" does not exist on jQuery."+a.name)})}}(jQuery),function(o){function a(){}o.extend(a.prototype,{name:"AssignElements",initialize:function(i){var n=this;o("ul.element-list").delegate("div.sort-event","mousedown",function(){o("li.element").not(".hideconfig").addClass("hideconfig")}),o("ul.element-list:not(.unassigned)").sortable({handle:"div.sort-event",connectWith:"ul.element-list:not(.unassigned)",placeholder:"element hideconfig dragging",forcePlaceholderSize:!0,cursorAt:{top:16},tolerance:"pointer",scroll:!1,change:function(e,t){n.emptyList()},update:function(e,t){t.item.hasClass("assigning")&&(i.find("li.assigning").each(function(){if(o(this).data("config")){var e=o(this).data("config").clone();e.find("input:radio").each(function(){o(this).attr("name",o(this).attr("name").replace(/^elements\[[\w_-]+\]/,"elements[_temp]"))}),t.item.append(e)}}),t.item.removeClass("assigning")),n.emptyList()},start:function(e,t){t.helper.addClass("ghost")},stop:function(e,t){t.item.removeClass("ghost"),n.emptyList().sanatizeList()}}),o("ul.element-list.unassigned li.element").draggable({handle:"div.sort-event",scroll:!1,zIndex:1e3,helper:function(){var e=o(this).clone();return e.find("div.config").remove(),e},connectToSortable:"ul.element-list:not(.unassigned)",drag:function(e,t){n.emptyList()},start:function(e,t){o(this).addClass("assigning"),o(this).data("config",o(this).find("div.config").remove()),t.helper.addClass("ghost")},stop:function(e,t){o(this).removeClass("assigning"),t.helper.removeClass("ghost"),o(this).append(o(this).data("config")),n.emptyList().sanatizeList()}}),this.emptyList().sanatizeList(),i.delegate("div.edit-event","click",function(){o(this).closest("li").toggleClass("hideconfig")}).delegate("div.delete-event","click",function(){o(this).closest("li").fadeOut(200,function(){o(this).remove(),n.emptyList().sanatizeList()})})},emptyList:function(){return o("ul.element-list:not(.unassigned)").each(function(){var e=o(this).hasClass("empty-list"),t=o(this).children(":not(.ui-sortable-helper)").length;(e&&t||!e&&!t)&&o(this).toggleClass("empty-list")}),this},sanatizeList:function(){var i=new RegExp(/(elements\[[a-z0-9_-]+\])|(positions\[[a-z0-9_-]+\]\[[0-9]+\])/);return o("ul.element-list:not(.unassigned)").each(function(){var t="positions["+o(this).data("position")+"]";o(this).children().each(function(e){o(this).find("[name^=positions], [name^=elements]").each(function(){o(this).attr("name","tmp"+o(this).attr("name").replace(i,t+"["+e+"]"))})})}),i=new RegExp(/^tmp/),o("ul.element-list").find("[name^=tmp]").each(function(){o(this).attr("name",o(this).attr("name").replace(i,""))}),this}}),o.fn[a.prototype.name]=function(){var i=arguments,n=i[0]?i[0]:null;return this.each(function(){var e=o(this);if(a.prototype[n]&&e.data(a.prototype.name)&&"initialize"!=n)e.data(a.prototype.name)[n].apply(e.data(a.prototype.name),Array.prototype.slice.call(i,1));else if(!n||o.isPlainObject(n)){var t=new a;a.prototype.initialize&&t.initialize.apply(t,o.merge([e],i)),e.data(a.prototype.name,t)}else o.error("Method "+n+" does not exist on jQuery."+a.name)})}}(jQuery),function(o){function a(){}o.extend(a.prototype,{name:"AssignSubmission",initialize:function(e){var i=this;o("ul.element-list").delegate("div.sort-event","mousedown",function(){o("li.element").not(".hideconfig").addClass("hideconfig")}).sortable({handle:"div.sort-event",connectWith:'ul.element-list:not([data-position="unassigned"])',placeholder:"element hideconfig dragging",forcePlaceholderSize:!0,cursorAt:{top:16},tolerance:"pointer",scroll:!1,start:function(e,t){t.helper.addClass("ghost")},stop:function(e,t){t.item.removeClass("ghost")},change:function(e,t){i.emptyList()},update:function(e,t){i.emptyList()}}),this.emptyList(),e.delegate("div.edit-event","click",function(){o(this).closest("li").toggleClass("hideconfig")}).delegate("div.delete-event","click",function(){o(this).closest("li").appendTo(o("ul.element-list[data-position=unassigned]")).addClass("hideconfig").effect("highlight",{},1e3),i.emptyList()}),o.each(["apply","save","save-new"],function(e,t){o("#toolbar-"+t+" a, #toolbar-"+t+" button").bind("validate.adminForm",function(e){o('ul.element-list:not([data-position="unassigned"])').each(function(){var i=o(this).data("position");o(this).children().each(function(e){var t=o(this).data("element");o(this).find('[name^="'+t+'"]').each(function(){o(this).attr("name","positions["+i+"]["+e+"]"+o(this).attr("name").replace(new RegExp(t),""))})})})})})},emptyList:function(){return o("ul.element-list").each(function(){o(this).removeClass("empty-list"),0==o(this).children(":not(.ui-sortable-helper)").length&&o(this).addClass("empty-list")}),this}}),o.fn[a.prototype.name]=function(){var i=arguments,n=i[0]?i[0]:null;return this.each(function(){var e=o(this);if(a.prototype[n]&&e.data(a.prototype.name)&&"initialize"!=n)e.data(a.prototype.name)[n].apply(e.data(a.prototype.name),Array.prototype.slice.call(i,1));else if(!n||o.isPlainObject(n)){var t=new a;a.prototype.initialize&&t.initialize.apply(t,o.merge([e],i)),e.data(a.prototype.name,t)}else o.error("Method "+n+" does not exist on jQuery."+a.name)})}}(jQuery),function(o){function a(){}o.extend(a.prototype,{name:"EditType",initialize:function(i){o.each(["apply","save"],function(e,t){o("#toolbar-"+t+" a").removeAttr("onclick").bind("click",function(e){""==i.find('input[name="name"]').val()?i.find("span.message-name").css("display","block"):submitbutton(t+"type")})})}}),o.fn[a.prototype.name]=function(){var i=arguments,n=i[0]?i[0]:null;return this.each(function(){var e=o(this);if(a.prototype[n]&&e.data(a.prototype.name)&&"initialize"!=n)e.data(a.prototype.name)[n].apply(e.data(a.prototype.name),Array.prototype.slice.call(i,1));else if(!n||o.isPlainObject(n)){var t=new a;a.prototype.initialize&&t.initialize.apply(t,o.merge([e],i)),e.data(a.prototype.name,t)}else o.error("Method "+n+" does not exist on jQuery."+a.name)})}}(jQuery);