/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

!function(n){function a(){}n.extend(a.prototype,{name:"autosuggest",options:{prefill:"",allowDuplicates:!0,inputName:"term[]",resultsHighlight:!0,addButtonText:"Add"},initialize:function(t,e){this.options=n.extend({},this.options,e);var i=this;this.input=t,n.extend(n.expr[":"],{focus:function(e){return e==document.activeElement}}),t.addClass("as-input").wrap('<ul class="as-selections">').wrap('<li class="as-original">').autocomplete(n.extend({select:function(e,t){i.addItem(t.item),t.item.value=t.item.label=""}},this.options)).bind("blur",function(e){i.selections_holder.addClass("blur").find("li.as-selection-item").removeClass("selected")}).bind("focus",function(){i.selections_holder.removeClass("blur")}).bind("keydown",function(e){switch(e.which){case 8:""==t.val()&&(e.preventDefault(),li=n("li.as-selection-item:last"),li.is(".selected")?i.removeItem(li):i.selectItem(li));break;case 9:e.preventDefault(),i.addItem(t.val())}}).bind("keypress",function(e){44==e.charCode&&(e.preventDefault(),i.addItem(t.val()))}),this.selections_holder=t.closest("ul.as-selections").bind("click",function(){t.not(":focus")&&t.focus()}),this.original=this.selections_holder.find("li.as-original"),n('<li class="add-tag-button" >').insertAfter(this.original).text(this.options.addButtonText).bind("click",function(){n.each(t.val().split(","),function(e,t){i.addItem(t)})}),"string"==typeof this.options.prefill?n.each(this.options.prefill.split(","),function(e,t){i.addItem(t)}):i.addItem(this.options.prefill),t.is(":focus")?t.focus():t.blur(),this.selections_holder.delegate("a.as-close","click",function(){i.removeItem(n(this).parent())}).delegate("li.as-selection-item","click",function(){i.selectItem(this)})},addItem:function(e){if("string"==typeof e&&(e={label:e.trim(),value:e.trim()}),""!=e.value&&(this.options.allowDuplicates||!this.itemExists(e))){var t=n('<li class="as-selection-item">').text(e.label).data("item",e).insertBefore(this.original);n('<a class="as-close">&times;</a>').appendTo(t),n('<input type="hidden" class="as-value">').attr("name",this.options.inputName).val(e.value).appendTo(t)}this.input.val(""),this.input.trigger("addItem",t)},removeItem:function(e){e.remove()},itemExists:function(e){var t=!1;return this.selections_holder.find("li.as-selection-item").each(function(){n(this).data("item")&&n(this).data("item").value.toLowerCase()==e.value.toLowerCase()&&(t=!0)}),t},selectItem:function(e){n("li.as-selection-item",this.selections_holder).not(e).removeClass("selected"),n(e).addClass("selected"),this.input.not(":focus")&&this.input.focus()}}),n.fn[a.prototype.name]=function(){var i=arguments,s=i[0]?i[0]:null;return this.each(function(){var e=n(this);if(a.prototype[s]&&e.data(a.prototype.name)&&"initialize"!=s)e.data(a.prototype.name)[s].apply(e.data(a.prototype.name),Array.prototype.slice.call(i,1));else if(!s||n.isPlainObject(s)){var t=new a;a.prototype.initialize&&t.initialize.apply(t,n.merge([e],i)),e.data(a.prototype.name,t)}else n.error("Method "+s+" does not exist on jQuery."+a.name)})}}(jQuery);